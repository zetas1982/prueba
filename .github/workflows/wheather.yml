name: Weather Notification

on:
  schedule:
    - cron: '0 7 * * *'  # Cada día a las 7:00 UTC (~9:00 en España)
  workflow_dispatch:

jobs:
  send_weather:
    runs-on: ubuntu-latest

    steps:
    - name: Get weather data
      id: weather
      run: |
        CITY="Madrid"
        API_KEY="${{ secrets.TIEMPO }}"  # consigue una gratis en openweathermap.org
        WEATHER=$(curl -s "https://api.openweathermap.org/data/2.5/weather?q=$CITY&appid=$API_KEY&units=metric")
        TEMP=$(echo $WEATHER | jq '.main.temp')
        DESC=$(echo $WEATHER | jq -r '.weather[0].description')
        echo "temp=${TEMP}" >> $GITHUB_OUTPUT
        echo "desc=${DESC}" >> $GITHUB_OUTPUT

    - name: Send message to Telegram
      run: |
        MESSAGE="🌤️ Clima en Granada: ${{ steps.weather.outputs.temp }}°C, ${{ steps.weather.outputs.desc }}"
        curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
        -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
        -d text="$MESSAGE"
